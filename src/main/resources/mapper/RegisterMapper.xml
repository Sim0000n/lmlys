<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="team.area237.lmlys.dao.RegisterDao">
    <select id="selectByUsername" resultType="String">
    select username from user where username = #{username}
    </select>
    <insert id="addUser">
    INSERT INTO user(username,password) VALUES(#{username},#{password})
    </insert>



    <resultMap id="UserDataResponse" type="team.area237.lmlys.model.response.UserDataResponse">
        <result column="email" jdbcType="VARCHAR" property="email"/>
        <result column="tel" jdbcType="VARCHAR" property="phone"/>
    </resultMap>

    <select id="dataSelectByUsername" resultMap="UserDataResponse">
    select email,tel from user where username = #{username}
    </select>

    <insert id="insertPhoneByUsername">
    insert into user (tel) values (#{phone}) where username=#{username}
    </insert>

    <insert id="insertEmailByUsername">
    insert into user (email) values (#{email}) where username=#{username}
    </insert>

    <insert id="insertBothByUsername">
    insert into user (tel,email) values (#{phone},#{email}) where username=#{username}
    </insert>

    <resultMap id="UserAdrress" type="team.area237.lmlys.model.response.GetUserAddressResponse">
        <result column="province" jdbcType="VARCHAR" property="province"/>
        <result column="city" jdbcType="VARCHAR" property="city"/>
        <result column="detail_address" jdbcType="VARCHAR" property="home"/>
    </resultMap>

    <select id="selectAddressByUsername" resultMap="UserAdrress">
    select province,city,detail_address from user where username = #{username}
    </select>

    <insert id="insertAddressByUsername" parameterType="team.area237.lmlys.model.request.UploadUserAddressRequest">
    insert into user (province,city,detail_address) values (#{province},#{city},#{home}) where username=#{username}
    </insert>

    <select id="selectProvince">
    select province_name from province
    </select>

    <select id="citySelectByProvince">
    SELECT city_name FROM city INNER JOIN province ON city.province_codes=province.province_codes WhERE province.province_name=#{province}
    </select>

    <update id="cartToOrder">
    update orders set status=1 where username=#{username}
    </update>

    <select id="selectOrderByUsername">
    select id from orders where username = #{username} order by date desc
    </select>

    <resultMap id="ordersbyum" type="team.area237.lmlys.model.response.GetOrderResponse">
        <result column="goods_id" jdbcType="int" property="goodsID"/>
        <result column="goods.goods_name" jdbcType="VARCHAR" property="goodsTitle"/>
        <result column="amount" jdbcType="int" property="count"/>
        <result column="status" jdbcType="tinyint" property="state"/>
        <result column="date" jdbcType="datetime" property="time"/>
    </resultMap>

    <select id="selectOrderById">
    (select goods_id from orders where username = #{username}) union
    (SELECT goods.goods_name FROM goods INNER JOIN orders ON goods.goods_id=orders.goods_id WhERE orders.username=#{username})union
    (select amount,status,date from orders where username = #{username})
    </select>


</mapper>